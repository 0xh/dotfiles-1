#!/usr/bin/env zsh
################################################################################
#       Author: Wenxuan Zhang                                                  #
#        Email: wenxuangm@gmail.com                                            #
#     HomePage: https://github.com/wfxr                                        #
################################################################################

# Plugin manager
[ -d ~/.zplugin/bin ] || {
    mkdir -p ~/.zplugin
    git clone --depth=1 https://github.com/zdharma/zplugin.git ~/.zplugin/bin
}
source "$HOME/.zplugin/bin/zplugin.zsh"
autoload -Uz _zplugin
(( ${+_comps} )) && _comps[zplugin]=_zplugin

# Git alias. See: https://github.com/robbyrussell/oh-my-zsh/wiki/Plugin:git
zplugin for \
    'OMZ::plugins/git/git.plugin.zsh' \
    'OMZ::plugins/git-extras/git-extras.plugin.zsh' \
    'OMZ::plugins/git-flow-avh/git-flow-avh.plugin.zsh' \
    'OMZ::plugins/mvn/mvn.plugin.zsh' \
    'OMZ::plugins/colored-man-pages/colored-man-pages.plugin.zsh'

zplugin as='completion' for \
    'OMZ::plugins/docker/_docker' \
    'OMZ::plugins/gem/_gem' \
    'OMZ::plugins/lein/_lein'

ZSH_AUTOSUGGEST_PARTIAL_ACCEPT_WIDGETS=(forward-word forward-char)
ZSH_AUTOSUGGEST_ACCEPT_WIDGETS=(end-of-line)
zplugin light-mode lucid wait depth='1' for \
    atload='_zsh_autosuggest_start' \
        'zsh-users/zsh-autosuggestions' \
    blockf \
        'zsh-users/zsh-completions' \
        'hlissner/zsh-autopair' \
        'zdharma/fast-syntax-highlighting' \
        'soimort/translate-shell'

FORGIT_FZF_DEFAULT_OPTS="--height '80%'"
zplugin light-mode lucid depth='1' for \
    'wfxr/forepos' \
    'wfxr/epoch-cli' \
    'wfxr/formarks' \
    'wfxr/forgit' \
    'rupa/z'
# 'skywind3000/z.lua' # better than rupa/z ?

EMOJI_CLI_KEYBIND='^[m'
zplugin light-mode as='program' depth='1' atpull='!git reset --hard' for \
    mv='src/ydcv.py -> src/ydcv' pick='src/ydcv'\
        'felixonmars/ydcv' \
    mv="iconful.sh -> iconful" \
        'wfxr/iconful' \
    if='[[ -z "$SSH_CLIENT" ]]' \
        'wfxr/fzf-chrome-marks' \
    atclone='git config --global core.pager "diff-so-fancy | less --tabs=4 -RFX"' \
        'so-fancy/diff-so-fancy' \
    multisrc='*.zsh' \
        'wfxr/emoji-cli' \
    mv="httpstat.py -> httpstat" \
        'reorx/httpstat'

zplugin light-mode as='program' from='gh-r' for \
    if='[[ -z $+commands[jq] ]]' mv="jq* -> jq" \
        'stedolan/jq' \

#######################################################################
#                               Themes                                #
#######################################################################
# 'denysdovhan/spaceship-prompt'
# 'bhilburn/powerlevel9k'
# 'subnixr/minimal'
# 'mafredri/zsh-async'
# 'sindresorhus/pure'

#######################################################################
#                            Local Plugins                            #
#######################################################################
for plugin in kubectl pyenv pip; do
    mkdir -p "${ZPLGM[PLUGINS_DIR]}/_local---$plugin"
    touch "${ZPLGM[PLUGINS_DIR]}/_local---$plugin/init.plugin.zsh"
done

zplugin light-mode lucid wait for \
    if='(( $+commands[kubectl] ))' atload='source <(kubectl completion zsh)' \
        '_local/kubectl' \
    if='(( $+commands[pip] ))'     atload='source <(pip completion --zsh)' \
        '_local/pip' \
    if='(( $+commands[pyenv] ))'   atload='source <(pyenv init - zsh)' \
        '_local/pyenv'

# Completions init
autoload -Uz compinit; compinit
zplugin cdreplay -q
