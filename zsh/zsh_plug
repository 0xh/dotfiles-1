#!/usr/bin/env zsh
################################################################################
#       Author: Wenxuan Zhang                                                  #
#        Email: wenxuangm@gmail.com                                            #
#     HomePage: https://github.com/wfxr                                        #
################################################################################

# Plugin manager
[ -d ~/.zplugin/bin ] || {
    mkdir -p ~/.zplugin
    git clone --depth=1 https://github.com/zdharma/zplugin.git ~/.zplugin/bin
}
source "$HOME/.zplugin/bin/zplugin.zsh"
autoload -Uz _zplugin
(( ${+_comps} )) && _comps[zplugin]=_zplugin

# No need to load it when in ssh session
zplugin ice if'[[ -z "$SSH_CLIENT" ]]' as"program" bpick"b"
zplugin load 'wfxr/fzf-chrome-marks'

# Git alias. See: https://github.com/robbyrussell/oh-my-zsh/wiki/Plugin:git
zplugin snippet "OMZ::plugins/git/git.plugin.zsh"
zplugin snippet "OMZ::plugins/git-extras/git-extras.plugin.zsh"
zplugin snippet "OMZ::plugins/git-flow-avh/git-flow-avh.plugin.zsh"

zplugin ice wait lucid
zplugin snippet "OMZ::plugins/mvn/mvn.plugin.zsh"

zplugin ice wait lucid
zplugin snippet "OMZ::plugins/colored-man-pages/colored-man-pages.plugin.zsh"

zplugin ice wait as"completion" lucid
zplugin snippet "OMZ::plugins/docker/_docker"

zplugin ice wait as"completion" lucid
zplugin snippet "OMZ::plugins/gem/_gem"

zplugin ice wait as"completion" lucid
zplugin snippet "OMZ::plugins/lein/_lein"

zplugin ice bpick"z.sh"
zplugin load "rupa/z"

ZSH_AUTOSUGGEST_PARTIAL_ACCEPT_WIDGETS=(forward-word forward-char)
ZSH_AUTOSUGGEST_ACCEPT_WIDGETS=(end-of-line)
zplugin light "zsh-users/zsh-autosuggestions"
zplugin light "zsh-users/zsh-syntax-highlighting"
zplugin light "zsh-users/zsh-completions"

zplugin light "zdharma/fast-syntax-highlighting"

# zplugin light 'ytet5uy4/fzf-widgets'

zplugin ice as"program"
zplugin light "felixonmars/ydcv"
alias ydcv='ydcv.py'

zplugin light "soimort/translate-shell"

zplugin ice as"program" atclone'git config --global core.pager "diff-so-fancy | less --tabs=4 -RFX"' \
    bpick"diff-so-fancy"
zplugin light "so-fancy/diff-so-fancy"

zplugin ice as"program"
zplugin light "wfxr/iconful"
alias iconful='iconful.sh'

zplugin light "wfxr/forepos"
zplugin light "wfxr/epoch-cli"
zplugin light "wfxr/formarks"

FORGIT_FZF_DEFAULT_OPTS="--height '80%'"
zplugin light "wfxr/forgit"

EMOJI_CLI_KEYBIND='^[m'
zplugin ice as"program" multisrc"*.zsh"
zplugin light "wfxr/emoji-cli"

zplugin ice if'[[ -z $+commands[jq] ]]' from"gh-r" as"program" mv"jq* -> jq"
zplugin light "stedolan/jq"

zplugin ice as"program"
zplugin light "reorx/httpstat"
alias httpstat='httpstat.py'

#######################################################################
#                               Themes                                #
#######################################################################
# zplug "denysdovhan/spaceship-prompt", as:theme
# zplug "wfxr/spaceship-zsh-theme", use:spaceship.zsh, as:theme
# zplug "bhilburn/powerlevel9k", use:powerlevel9k.zsh-theme, as:theme
# zplug "subnixr/minimal", as:theme, use:"minimal.zsh"
# zplug "mafredri/zsh-async"
# zplug "sindresorhus/pure", use:pure.zsh, as:theme

#######################################################################
#                            Local Plugins                            #
#######################################################################
for plugin in kubectl pyenv pip; do
    mkdir -p "${ZPLGM[PLUGINS_DIR]}/_local---$plugin"
    touch "${ZPLGM[PLUGINS_DIR]}/_local---$plugin/init.plugin.zsh"
done

zplugin ice wait atload'source <(kubectl completion zsh)' lucid
zplugin light _local/kubectl

zplugin ice wait atload'source <(pip completion --zsh)' lucid
zplugin light _local/pip

zplugin ice wait atload'source <(pyenv init - zsh)' lucid
zplugin light _local/pyenv

# Completions init
autoload -Uz compinit
compinit
zplugin cdreplay -q
