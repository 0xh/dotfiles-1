#!/usr/bin/env zsh
################################################################################
#       Author: Wenxuan Zhang                                                  #
#        Email: wenxuangm@gmail.com                                            #
#     HomePage: https://github.com/wfxr                                        #
################################################################################

# Plugin manager
[ -d ~/.zplugin/bin ] || {
    mkdir -p ~/.zplugin
    git clone --depth=1 https://github.com/zdharma/zplugin.git ~/.zplugin/bin
}
source "$HOME/.zplugin/bin/zplugin.zsh"
autoload -Uz _zplugin
(( ${+_comps} )) && _comps[zplugin]=_zplugin

# No need to load it when in ssh session
zpl ice if'[[ -z "$SSH_CLIENT" ]]' as"program" bpick"b"
zpl load 'wfxr/fzf-chrome-marks'

# Git alias. See: https://github.com/robbyrussell/oh-my-zsh/wiki/Plugin:git
zpl snippet "OMZ::plugins/git/git.plugin.zsh"
zpl snippet "OMZ::plugins/git-extras/git-extras.plugin.zsh"
zpl snippet "OMZ::plugins/git-flow-avh/git-flow-avh.plugin.zsh"

zpl ice wait lucid
zpl snippet "OMZ::plugins/mvn/mvn.plugin.zsh"

cmd="zpl ice wait lucid"
zpl ice wait lucid
zpl snippet "OMZ::plugins/colored-man-pages/colored-man-pages.plugin.zsh"

zpl ice wait as"completion" lucid
zpl snippet "OMZ::plugins/docker/_docker"

zpl ice wait as"completion" lucid
zpl snippet "OMZ::plugins/gem/_gem"

zpl ice wait as"completion" lucid
zpl snippet "OMZ::plugins/lein/_lein"

zpl ice bpick"z.sh"
zpl load "rupa/z"

ZSH_AUTOSUGGEST_PARTIAL_ACCEPT_WIDGETS=(forward-word forward-char)
ZSH_AUTOSUGGEST_ACCEPT_WIDGETS=(end-of-line)
zpl light "zsh-users/zsh-autosuggestions"
zpl light "zsh-users/zsh-syntax-highlighting"
zpl light "zsh-users/zsh-completions"

zpl light "zdharma/fast-syntax-highlighting"

# zplugin light 'ytet5uy4/fzf-widgets'

zpl ice as"program" pick"src/ydcv.py"
zpl light "felixonmars/ydcv"
alias ydcv="ydcv.py"

zpl light "soimort/translate-shell"

zpl ice as"program" atclone'git config --global core.pager "diff-so-fancy | less --tabs=4 -RFX"' \
    bpick"diff-so-fancy"
zpl light "so-fancy/diff-so-fancy"

zpl ice as"program"
zpl light "wfxr/iconful"
alias iconful='iconful.sh'

zpl light "wfxr/forepos"
zpl light "wfxr/epoch-cli"
zpl light "wfxr/formarks"

FORGIT_FZF_DEFAULT_OPTS="--height '80%'"
zpl light "wfxr/forgit"

EMOJI_CLI_KEYBIND='^[m'
zpl ice as"program" multisrc"*.zsh"
zpl light "wfxr/emoji-cli"

zpl ice if'[[ -z $+commands[jq] ]]' from"gh-r" as"program" mv"jq* -> jq"
zpl light "stedolan/jq"

zpl ice as"program"
zpl light "reorx/httpstat"
alias httpstat='httpstat.py'

#######################################################################
#                               Themes                                #
#######################################################################
# zplug "denysdovhan/spaceship-prompt", as:theme
# zplug "wfxr/spaceship-zsh-theme", use:spaceship.zsh, as:theme
# zplug "bhilburn/powerlevel9k", use:powerlevel9k.zsh-theme, as:theme
# zplug "subnixr/minimal", as:theme, use:"minimal.zsh"
# zplug "mafredri/zsh-async"
# zplug "sindresorhus/pure", use:pure.zsh, as:theme

#######################################################################
#                            Local Plugins                            #
#######################################################################
for plugin in kubectl pyenv pip; do
    mkdir -p "${ZPLGM[PLUGINS_DIR]}/_local---$plugin"
    touch "${ZPLGM[PLUGINS_DIR]}/_local---$plugin/init.plugin.zsh"
done

zpl ice wait atload'source <(kubectl completion zsh)' lucid
zpl light _local/kubectl

zpl ice wait atload'source <(pip completion --zsh)' lucid
zpl light _local/pip

zpl ice wait atload'source <(pyenv init - zsh)' lucid
zpl light _local/pyenv

# Completions init
autoload -Uz compinit
compinit
zpl cdreplay -q
